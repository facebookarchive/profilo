(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{46:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return b}));n(0);var a=n(60);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o={id:"trace-processing",title:"Trace Processing",sidebar_label:"Trace Processing"},i=[{value:"Design",id:"design",children:[]},{value:"Trace model",id:"trace-model",children:[]},{value:"Workflow",id:"workflow",children:[]}],c={rightToc:i};function b(e){var t=e.components,n=l(e,["components"]);return Object(a.b)("wrapper",r({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"design"},"Design"),Object(a.b)("p",null,"Profilo comes with a Python library which can parse traces into a semantic trace object. This trace object can then be traversed and examined to extract meaningful metrics."),Object(a.b)("h2",{id:"trace-model"},"Trace model"),Object(a.b)("p",null,"The semantic trace objects follow a hierarchy (or trace model):"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Traces")," consist of execution units."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Execution units")," consist of ",Object(a.b)("em",{parentName:"p"},"blocks"),". Execution units are usually individual threads in Profilo traces."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Blocks")," consist of ",Object(a.b)("em",{parentName:"p"},"points"),". A block always has a start and end point. Points within a block can share timestamps but are uniquely identifiable."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Edges")," can indicate change of control flow between any two points. There's an implicit edge between the start and end points of a block, as well as between the boundary points of consecutive blocks in an execution unit. All other edges must be explicitly created."),Object(a.b)("p",null,'All of the above objects can have "annotations" (props in API) attached to them. Annotations are key-value pairs with very loose typing.'),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),"--Execution Unit 1--------------------\n\n  Block A      Block B\n[s.--\x3e  .e]--\x3e[s --\x3e .e]\n  |     ^            |\n  v     |            |\n  [s--\x3ee]            |\n  Block C            |\n                     |\n---------------------|----------------\n                     |\n--Execution Unit 2---|----------------\n                     |\n                     v Block D\n                     [s --\x3e e]\n\n--------------------------------------\n")),Object(a.b)("p",null,"In the diagram above, the edges are as follows:"),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",r({parentName:"tr"},{align:null}),"Edge Source"),Object(a.b)("th",r({parentName:"tr"},{align:null}),"Edge Target"),Object(a.b)("th",r({parentName:"tr"},{align:null}),"Type"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block A, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block A, end point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Implicit")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block B, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block B, end point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Implicit")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block C, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block C, end point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Implicit")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block D, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block D, end point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Implicit")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block A, 2nd point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block C, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Explicit, child call")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block C, end point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block A, 3rd point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Explicit, child return")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block B, 2nd point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Block D, start point"),Object(a.b)("td",r({parentName:"tr"},{align:null}),"Explicit, async call")))),Object(a.b)("h2",{id:"workflow"},"Workflow"),Object(a.b)("p",null,"The complete flow for tracing-downloading-analyzing is as follows:"),Object(a.b)("ol",{start:0},Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Ensure you have a environment which contains the dependencies listed in ",Object(a.b)("inlineCode",{parentName:"p"},"python/requirements.txt"),". For example, you can use ",Object(a.b)("a",r({parentName:"p"},{href:"https://github.com/pypa/virtualenv"}),"virtualenv")," like so:"),Object(a.b)("pre",{parentName:"li"},Object(a.b)("code",r({parentName:"pre"},{}),"virtualenv -p python3 env\nsource env/bin/activate\npip3 install -r requirements.txt\n"))),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Start and stop a trace in the app. (You can use the sample app to play with traces)")),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Download the trace on a host. This can be done in a few ways:"),Object(a.b)("p",{parentName:"li"},"a. Navigate to python/ and run"),Object(a.b)("p",{parentName:"li"},"   ",Object(a.b)("inlineCode",{parentName:"p"},"python3 -m profilo.profilo pull_traces --last <your_application_package>")),Object(a.b)("p",{parentName:"li"},"   In this case:"),Object(a.b)("p",{parentName:"li"},"   ",Object(a.b)("inlineCode",{parentName:"p"},"python3 -m profilo.profilo pull_traces --last com.facebook.profilo.sample")))),Object(a.b)("p",null,"   b. Navigate to ",Object(a.b)("inlineCode",{parentName:"p"},"python/profilo/device"),', start an interactive Python shell, and\nuse the "device" module directly:'),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{}),'  ```\n  import device\n\n  device.pull_last_trace("com.example.package.name")\n  ```\n')),Object(a.b)("p",null,"   Both approaches will result in a file with the same name as the trace to be created in the current directory."),Object(a.b)("ol",{start:3},Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Analyze the data. A sample demo script is provided in ",Object(a.b)("inlineCode",{parentName:"p"},"python/profilo/workflow_demo.py"),"."),Object(a.b)("p",{parentName:"li"}," You can run from within the ",Object(a.b)("inlineCode",{parentName:"p"},"python/")," folder via ",Object(a.b)("inlineCode",{parentName:"p"},"python3 -m profilo.workflow_demo --help"),". Don't forget to activate your virtualenv first, if you are using one."),Object(a.b)("p",{parentName:"li"}," The workflow demo contains logic to perform analysis on stacks, blocks, and system counters."),Object(a.b)("p",{parentName:"li"},"a. Stacks:\nParses the sampled stacks from a trace file into a format similar to that of DTrace. This allows for visualizations such as ",Object(a.b)("a",r({parentName:"p"},{href:"https://github.com/brendangregg/FlameGraph"}),"FlameGraph"),"."),Object(a.b)("p",{parentName:"li"},"   Note that functions for which we couldn't find symbols will just show up as numbers."),Object(a.b)("p",{parentName:"li"}," b. Blocks:\nParses the instrumented start-end blocks from a trace file and outputs some per-thread statistics (mean, median, std) about execution times in\ncsv format."),Object(a.b)("p",{parentName:"li"}," c. System counters:\nParses system counters from a trace file and sorts them by timestamp so as to obtain a time series. A command line argument must be used to\ndefine the output path for the generated graphs."))))}b.isMDXComponent=!0}}]);